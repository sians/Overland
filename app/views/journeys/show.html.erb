<div class="container">
  <div class="back">
    <%= link_to profile_path do %>
      <i class="fas fa-arrow-left"></i>
    <% end %>
  </div>
  <div class="route-detail">
    <div class="route-detail-header">
      <div class="journey-details">
        <h1><%= @journey.name %></h1>
        <p><%= @journey.total_duration %></p>
      </div>
      <%= link_to 'View Bookings', bookings_path, class: 'btn btn-book' %>
    </div>
    <div class="route-connection-cards">
      <% @journey.connections.reverse.each do |connection| %>
        <% @connection = connection %>
        <div class="route-connection-card">
          <div class="line"></div>
          <div class="route-connection-content d-flex">
            <div>
              <% if Journey::TRAINS.include? connection[:transport_type] %>
              <%= image_tag 'icons/train-icontrain.png' %>
              <% elsif Journey::SUBWAYS.include? connection[:transport_type] %>
              <%= image_tag 'icons/subway-iconsubway.png' %>
              <% elsif Journey::BUS.include? connection[:transport_type] %>
              <%= image_tag 'icons/bus-iconbus.png' %>
              <% end %>
            </div>
            <div class="route-connections">
              <h4><strong> <%= Geocoder.search([connection[:start_latitude],connection[:start_longitude]]).first.country %></strong> - <%= connection[:origin_city] %></h4>
              <p></p>
              <h4><strong> <%= Geocoder.search([connection[:end_latitude],connection[:end_longitude]]).first.country %></strong> - <%= connection[:destination_city] %></h4>
              <p></p>
            </div>
            <div class="duration">
              <strong> <%= (Time.at(connection[:end_time].to_i) - (connection[:start_time].to_i)).utc.strftime("%Hh%Mm") %></strong>
            </div>
            <div>
              <p>Service Provider</p>
              <%= link_to connection[:provider], connection[:provider_website], target: :_blank %>
            </div>
            <div>
              <%= simple_form_for @connection do |f| %>
                <%= f.input :booking_status %>
                <%= f.button :submit, class:"btn btn-go" %>
              <% end %>
            </div>
          </div>
        </div>

        <% unless connection.poi_bookings.empty? %>
          <div class="your-recommendations">
            <p class="italic">Your chosen recommendations for <%= Geocoder.search([connection[:start_latitude],connection[:start_longitude]]).first.city %>:</p>
          </div>
          <% connection.poi_bookings.each do |poi_booking| %>
            <div class="connection-poi-card">
              <h5><%= poi_booking.poi.name %></h5>
              <div class="poi-details">
                <p><%= poi_booking.poi.address %></p>
                <p>
                  <%= poi_booking.poi.phone_number %>
                  <%= link_to 'visit website', poi_booking.poi.website.to_s, target: '_blank' %>
                </p>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
