<% route_connections = @directions.get_route_connections("o", "d", current_user.storage) %>
<div class="main-container">
  <div class="row">

    <div class="col-12 col-md-4 col-lg-4">

      <div class="btn-container">
        <%#= link_to 'Back to Journeys', journey_results_path, class: 'btn btn-back' %>

        <%= link_to 'Save Trip', journeys_path, method: :post, class: 'btn btn-book' %>
      </div>

      <% unless route_connections.nil? %>

      <% route_connections.each do |route|%>
        <% route[1][:connections].each do |connection| %>
          <div class="connection-card">
            <div class="connection-card-top">
              <h6><strong> <%= Time.at(connection[:start_time]).strftime("%A, %B %-d") %></strong></h6>
<!--               <p><strong>Price: 74â‚¬</strong></p> -->
            </div>
          <div class="connection-card-bottom">
            <div class="connection-detail">
              <div class="connection-city">
                <p><%= Geocoder.search([connection[:start_latitude], connection[:start_longitude]]).first.city%> - <strong><%=Time.at(connection[:start_time]).strftime("%Hh:%Mm") %></strong></p>
                <p class="station"><strong> <%= connection[:origin_city] %></strong></p>
              </div>
              <div class="d-flex icon-row" style="justify-content: space-between">
                <div>
                  <% if ["Train", "Long distance train", "High speed train"].include? connection[:transport_type] %>
                    <%= image_tag 'icons/train-icontrain.png' %>
                  <% elsif ["Subway", "Commuter train", "Tram"].include? connection[:transport_type] %>
                    <%= image_tag 'icons/subway-iconsubway.png' %>
                  <% elsif ["Bus"].include? connection[:transport_type] %>
                    <%= image_tag 'icons/bus-iconbus.png' %>
                  <% end %>
                </div>
                <div class="duration">
                  <strong> <%= Time.at(connection[:end_time]-connection[:start_time]-3600).strftime("%Hh:%Mm") %></strong>
                </div>
              </div>
            <div class="connection-city">
              <p><%= Geocoder.search([connection[:end_latitude], connection[:end_longitude]]).first.city%> - <strong><%=Time.at(connection[:end_time]).strftime("%Hh:%Mm") %></strong></p>
              <p class="station"><strong><%= connection[:destination_city] %></strong></p>
            </div>
          </div>
        </div>
      </div>
      <% end %>
      <% end %>

      <% end %>

    </div>


    <div class="col-12 col-md-8 col-lg-8 map-section">
      <div id="map" data-markers="<%= @markers.to_json %>" style="position: fixed"></div>
    </div>
  </div>
</div>

